---
import PageLayout from "@layouts/PageLayout.astro";
import Layout from "@layouts/Layout.astro";
import { type CollectionEntry, getCollection } from "astro:content";

export interface Props {
  page: CollectionEntry<"pages">;
}

export async function getStaticPaths() {
  const pages = await getCollection("pages", ({ data }) => {
    const dataAny = data as any;
    return !('hidden' in dataAny && dataAny.hidden);
  });
  return pages.map((page) => {
    const slug = page.slug.replace(/index$/, "");
    if (slug.length === 0) return { params: { slug: undefined }, props: { page } };
    return { params: { slug }, props: { page } };
  });
}

const page = Astro.props.page;
const pageData = page.data as any;

// Pages without content_blocks (like template-examples) render content directly
const { Content } = await page.render();
---
{pageData.content_blocks ? (
  <PageLayout frontmatter={pageData} />
) : (
  <Layout title={pageData.title} seo={pageData.seo}>
    <Content />
  </Layout>
)}


